apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: openobservedashboards.openobserve.ai
spec:
  group: openobserve.ai
  names:
    kind: OpenObserveDashboard
    listKind: OpenObserveDashboardList
    plural: openobservedashboards
    singular: openobservedashboard
    shortNames:
    - o2dash
    - o2dashboard
  scope: Namespaced
  versions:
  - name: v1alpha1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            required:
            - configRef
            - title
            - dashboard
            properties:
              configRef:
                type: object
                required:
                - name
                properties:
                  name:
                    type: string
                    description: Name of the OpenObserveConfig resource
                  namespace:
                    type: string
                    description: Namespace of the OpenObserveConfig resource (defaults to same namespace)
              title:
                type: string
                description: Dashboard title - must be unique within the organization and folder
              org:
                type: string
                default: "default"
                description: Organization name to create the dashboard in. If not specified, defaults to "default"
              folderName:
                type: string
                default: "default"
                description: Folder name for organizing dashboards. If not specified, defaults to "default". Will be auto-created if it doesn't exist.
              description:
                type: string
                description: Human-readable description of the dashboard
              dashboard:
                type: object
                x-kubernetes-preserve-unknown-fields: true
                description: Complete dashboard definition including tabs, panels, queries, and visualizations. This is stored as raw JSON to support the complex dashboard structure.
          status:
            type: object
            properties:
              conditions:
                type: array
                items:
                  type: object
                  properties:
                    type:
                      type: string
                    status:
                      type: string
                    lastTransitionTime:
                      type: string
                      format: date-time
                    reason:
                      type: string
                    message:
                      type: string
                    observedGeneration:
                      type: integer
                      format: int64
              dashboardId:
                type: string
                description: Dashboard ID assigned by OpenObserve
              folderId:
                type: string
                description: Folder ID where the dashboard is stored
              lastSyncTime:
                type: string
                format: date-time
                description: Timestamp of the last successful sync with OpenObserve
              observedGeneration:
                type: integer
                format: int64
                description: The generation of the most recently observed dashboard
              deletionRetryCount:
                type: integer
                description: Tracks the number of deletion attempts
    additionalPrinterColumns:
    - name: Title
      type: string
      jsonPath: .spec.title
      description: Dashboard title
    - name: Org
      type: string
      jsonPath: .spec.org
      description: Organization name
    - name: Folder
      type: string
      jsonPath: .spec.folderName
      description: Folder name
    - name: Ready
      type: string
      jsonPath: .status.conditions[?(@.type=="Ready")].status
      description: Ready status
    - name: Age
      type: date
      jsonPath: .metadata.creationTimestamp
      description: Age of the resource
    subresources:
      status: {}
