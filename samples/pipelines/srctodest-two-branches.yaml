apiVersion: openobserve.ai/v1alpha1
kind: OpenObservePipeline
metadata:
  name: src-to-dest-test
  namespace: o2operator
spec:
  # Reference to OpenObserveConfig
  configRef:
    name: openobserve-main       #dont forget to change this to your OpenObserveConfig
    namespace: o2operator

  # Pipeline metadata - matching the JSON
  name: "src-to-dest-test"
  description: ""
  enabled: true

  # Organization (from JSON)
  org: "default"

  # Pipeline ID from JSON (optional - will be auto-generated if not provided)
  # pipeline_id: "7400591410606374912"

  # Source configuration (from JSON source section)
  # This automatically creates the input node - we don't define it in nodes
  source:
    streamName: "application_logs"        # from source.stream_name
    streamType: "logs"        # from source.stream_type
    sourceType: "realtime"    # from source.source_type

  # Processing nodes
  # Note: In the operator YAML, we DON'T define the input node (it's created from source)
  # We only define processing and output nodes
  nodes:
    - id: "node1"
      type: "condition"
      name: "Filter info logs"
      config:
        conditions:
          - column: "level"
            operator: "="
            value: "info"
            ignore_case: true

    - id: "node2"
      type: "function"
      name: "Process false"
      config:
        function: processfalse
        after_flatten: true
        num_args: 0

    # Output node from JSON (id: a4013ee8-bc22-4977-af3e-3e13fb78161f)
    - id: "output-stream-1"
      type: "stream"          # from data.node_type
      name: "Output Stream"
      config:
        stream_name: "test"   # from data.stream_name
        stream_type: "logs"   # from data.stream_type
        # org_id is inherited from pipeline
    # Output node from JSON (id: a4013ee8-bc22-4977-af3e-3e13fb78161f)
    - id: "output-stream-2"
      type: "remote_stream"          # from data.node_type
      name: "Output Stream"
      config:
        destination_name: "openobserve"

  # Edges - simplified since source automatically connects to first node
  # In this simple case, the edge from source to output is implicit
  # edges: []  # Empty because it's a direct source->output connection
  edges:
    - source: "node1"
      target: "output-stream-1"
    - source: "node2"
      target: "output-stream-2"